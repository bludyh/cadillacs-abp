stages:
    - build
    - test
    - deploy

cache:
    key: "$CI_PROJECT_NAMESPACE-$CI_PROJECT_NAME"
    paths:
        - .nuget/

variables:
    APIGATEWAY_DIR: "./src/ApiGateway"

.build_dotnetcore: &build_dotnetcore
    stage: build
    image: mcr.microsoft.com/dotnet/core/sdk:3.1-buster
    script:
        - dotnet restore --packages ./.nuget/ --verbosity normal
        - dotnet build --no-restore -c Release --verbosity normal

build_apigateway:
    <<: *build_dotnetcore
    before_script:
        - cd $APIGATEWAY_DIR/
    artifacts:
        name: "$CI_JOB_NAME-$CI_COMMIT_REF_NAME"
        expire_in: 1 day
        paths:
            - $APIGATEWAY_DIR/bin/Release/netcoreapp3.1/